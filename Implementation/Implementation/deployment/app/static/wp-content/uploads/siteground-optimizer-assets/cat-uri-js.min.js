/*! URI.js v1.14.1 http://medialize.github.io/URI.js/ */(function(a,b){"object"==typeof exports?module.exports=b(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"==typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],b):a.URI=b(a.punycode,a.IPv6,a.SecondLevelDomains,a)})(this,function(h,q,g,d){var r,b,e,o,k,m,u,v,t,w;function a(b,c){return this instanceof a?(void 0===b&&(b="undefined"!=typeof location?location.href+"":""),this.href(b),void 0!==c?this.absoluteTo(c):this):new a(b,c)}function f(a){return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function l(a){return void 0===a?"Undefined":String(Object.prototype.toString.call(a)).slice(8,-1)}function c(a){return"Array"===l(a)}function j(d,b){var a,e,f;if(c(b)){a=0;for(e=b.length;a<e;a++)if(!j(d,b[a]))return!1;return!0}f=l(b),a=0;for(e=d.length;a<e;a++)if("RegExp"===f){if("string"==typeof d[a]&&d[a].match(b))return!0}else if(d[a]===b)return!0;return!1}function p(a,b){if(!c(a)||!c(b)||a.length!==b.length)return!1;a.sort(),b.sort();for(var d=0,e=a.length;d<e;d++)if(a[d]!==b[d])return!1;return!0}function x(a){return escape(a)}function n(a){return encodeURIComponent(a).replace(/[!'()*]/g,x).replace(/\*/g,"%2A")}function i(a){return function(b,c){return void 0===b?this._parts[a]||"":(this._parts[a]=b||null,this.build(!c),this)}}function s(a,b){return function(c,d){return void 0===c?this._parts[a]||"":(null!==c&&(c+="",c.charAt(0)===b&&(c=c.substring(1))),this._parts[a]=c,this.build(!d),this)}}r=d&&d.URI,a.version="1.14.1",b=a.prototype,e=Object.prototype.hasOwnProperty,a._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:a.duplicateQueryParameters,escapeQuerySpace:a.escapeQuerySpace}},a.duplicateQueryParameters=!1,a.escapeQuerySpace=!0,a.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,a.idn_expression=/[^a-z0-9\.-]/i,a.punycode_expression=/(xn--)/i,a.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,a.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,a.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))/ig,a.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u201e\u2018\u2019]+$/},a.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},a.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,a.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},a.getDomAttribute=function(b){if(b&&b.nodeName){var c=b.nodeName.toLowerCase();return"input"===c&&"image"!==b.type?void 0:a.domAttributes[c]}},a.encode=n,a.decode=decodeURIComponent,a.iso8859=function(){a.encode=escape,a.decode=unescape},a.unicode=function(){a.encode=n,a.decode=decodeURIComponent},a.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}}},a.encodeQuery=function(d,b){var c=a.encode(d+"");return void 0===b&&(b=a.escapeQuerySpace),b?c.replace(/%20/g,"+"):c},a.decodeQuery=function(b,c){b+="",void 0===c&&(c=a.escapeQuerySpace);try{return a.decode(c?b.replace(/\+/g,"%20"):b)}catch(a){return b}},a.recodePath=function(b){b=(b+"").split("/");for(var c=0,d=b.length;c<d;c++)b[c]=a.encodePathSegment(a.decode(b[c]));return b.join("/")},a.decodePath=function(b){b=(b+"").split("/");for(var c=0,d=b.length;c<d;c++)b[c]=a.decodePathSegment(b[c]);return b.join("/")},o={encode:"encode",decode:"decode"},m=function(c,b){return function(d){try{return a[b](d+"").replace(a.characters[c][b].expression,function(d){return a.characters[c][b].map[d]})}catch(a){return d}}};for(k in o)a[k+"PathSegment"]=m("pathname",o[k]);return a.encodeReserved=m("reserved","encode"),a.parse=function(b,d){var c;return d||(d={}),c=b.indexOf("#"),-1<c&&(d.fragment=b.substring(c+1)||null,b=b.substring(0,c)),c=b.indexOf("?"),-1<c&&(d.query=b.substring(c+1)||null,b=b.substring(0,c)),"//"===b.substring(0,2)?(d.protocol=null,b=b.substring(2),b=a.parseAuthority(b,d)):(c=b.indexOf(":"),-1<c&&(d.protocol=b.substring(0,c)||null,d.protocol&&!d.protocol.match(a.protocol_expression)?d.protocol=void 0:"//"===b.substring(c+1,c+3)?(b=b.substring(c+3),b=a.parseAuthority(b,d)):(b=b.substring(c+1),d.urn=!0))),d.path=b,d},a.parseHost=function(a,b){var c=a.indexOf("/"),d;return-1===c&&(c=a.length),"["===a.charAt(0)?(d=a.indexOf("]"),b.hostname=a.substring(1,d)||null,b.port=a.substring(d+2,c)||null,"/"===b.port&&(b.port=null)):a.indexOf(":")!==a.lastIndexOf(":")?(b.hostname=a.substring(0,c)||null,b.port=null):(d=a.substring(0,c).split(":"),b.hostname=d[0]||null,b.port=d[1]||null),b.hostname&&"/"!==a.substring(c).charAt(0)&&(c++,a="/"+a),a.substring(c)||"/"},a.parseAuthority=function(b,c){return b=a.parseUserinfo(b,c),a.parseHost(b,c)},a.parseUserinfo=function(c,d){var b=c.indexOf("/"),e=c.lastIndexOf("@",-1<b?b:c.length-1);return-1<e&&(-1===b||e<b)?(b=c.substring(0,e).split(":"),d.username=b[0]?a.decode(b[0]):null,b.shift(),d.password=b[0]?a.decode(b.join(":")):null,c=c.substring(e+1)):(d.username=null,d.password=null),c},a.parseQuery=function(f,i){if(!f)return{};if(f=f.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!f)return{};for(var c={},h=f.split("&"),j=h.length,d,b,g=0;g<j;g++)d=h[g].split("="),b=a.decodeQuery(d.shift(),i),d=d.length?a.decodeQuery(d.join("="),i):null,e.call(c,b)?("string"==typeof c[b]&&(c[b]=[c[b]]),c[b].push(d)):c[b]=d;return c},a.build=function(b){var c="";return b.protocol&&(c+=b.protocol+":"),b.urn||!c&&!b.hostname||(c+="//"),c+=a.buildAuthority(b)||"","string"==typeof b.path&&("/"!==b.path.charAt(0)&&"string"==typeof b.hostname&&(c+="/"),c+=b.path),"string"==typeof b.query&&b.query&&(c+="?"+b.query),"string"==typeof b.fragment&&b.fragment&&(c+="#"+b.fragment),c},a.buildHost=function(b){var c="";if(b.hostname)c=a.ip6_expression.test(b.hostname)?c+("["+b.hostname+"]"):c+b.hostname;else return"";return b.port&&(c+=":"+b.port),c},a.buildAuthority=function(b){return a.buildUserinfo(b)+a.buildHost(b)},a.buildUserinfo=function(b){var c="";return b.username&&(c+=a.encode(b.username),b.password&&(c+=":"+a.encode(b.password)),c+="@"),c},a.buildQuery=function(d,k,j){var g="",h,b,f,i;for(b in d)if(e.call(d,b)&&b)if(c(d[b]))for(h={},f=0,i=d[b].length;f<i;f++)void 0!==d[b][f]&&void 0===h[d[b][f]+""]&&(g+="&"+a.buildQueryParameter(b,d[b][f],j),!0!==k&&(h[d[b][f]+""]=!0));else void 0!==d[b]&&(g+="&"+a.buildQueryParameter(b,d[b],j));return g.substring(1)},a.buildQueryParameter=function(d,b,c){return a.encodeQuery(d,c)+(null!==b?"="+a.encodeQuery(b,c):"")},a.addQuery=function(d,b,f){if("object"==typeof b)for(var g in b)e.call(b,g)&&a.addQuery(d,g,b[g]);else if("string"==typeof b)void 0===d[b]?d[b]=f:("string"==typeof d[b]&&(d[b]=[d[b]]),c(f)||(f=[f]),d[b]=(d[b]||[]).concat(f));else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},a.removeQuery=function(h,b,f){var d,j,g,i;if(c(b))for(f=0,d=b.length;f<d;f++)h[b[f]]=void 0;else if("object"==typeof b)for(d in b)e.call(b,d)&&a.removeQuery(h,d,b[d]);else if("string"==typeof b)if(void 0!==f){if(h[b]===f)h[b]=void 0;else if(c(h[b])){if(d=h[b],j={},c(f))for(g=0,i=f.length;g<i;g++)j[f[g]]=!0;else j[f]=!0;g=0;for(i=d.length;g<i;g++)void 0!==j[d[g]]&&(d.splice(g,1),i--,g--);h[b]=d}}else h[b]=void 0;else throw new TypeError("URI.addQuery() accepts an object, string as the first parameter")},a.hasQuery=function(d,b,f,g){if("object"==typeof b){for(var h in b)if(e.call(b,h)&&!a.hasQuery(d,h,b[h]))return!1;return!0}if("string"!=typeof b)throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");switch(l(f)){case"Undefined":return b in d;case"Boolean":return d=Boolean(c(d[b])?d[b].length:d[b]),f===d;case"Function":return!!f(d[b],b,d);case"Array":return!!c(d[b])&&(g?j:p)(d[b],f);case"RegExp":return c(d[b])?!!g&&j(d[b],f):Boolean(d[b]&&d[b].match(f));case"Number":f=String(f);case"String":return c(d[b])?!!g&&j(d[b],f):d[b]===f;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},a.commonPath=function(b,c){var d=Math.min(b.length,c.length),a;for(a=0;a<d;a++)if(b.charAt(a)!==c.charAt(a)){a--;break}return 1>a?b.charAt(0)===c.charAt(0)&&"/"===b.charAt(0)?"/":"":(("/"!==b.charAt(a)||"/"!==c.charAt(a))&&(a=b.substring(0,a).lastIndexOf("/")),b.substring(0,a+1))},a.withinString=function(c,k,d){var g,h,i,j,b,e,f;d||(d={}),g=d.start||a.findUri.start,h=d.end||a.findUri.end,i=d.trim||a.findUri.trim,j=/[a-z0-9-]=["']?$/i;for(g.lastIndex=0;;){if(b=g.exec(c),!b)break;if(b=b.index,d.ignoreHtml)if(e=c.slice(Math.max(b-3,0),b),e&&j.test(e))continue;e=b+c.slice(b).search(h),f=c.slice(b,e).replace(i,""),d.ignore&&d.ignore.test(f)||(e=b+f.length,f=k(f,b,e,c),c=c.slice(0,b)+f+c.slice(e),g.lastIndex=b+f.length)}return g.lastIndex=0,c},a.ensureValidHostname=function(b){if(b.match(a.invalid_hostname_characters)){if(!h)throw new TypeError('Hostname "'+b+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available');if(h.toASCII(b).match(a.invalid_hostname_characters))throw new TypeError('Hostname "'+b+'" contains characters other than [A-Z0-9.-]')}},a.noConflict=function(a){return a?(a={URI:this.noConflict()},d.URITemplate&&"function"==typeof d.URITemplate.noConflict&&(a.URITemplate=d.URITemplate.noConflict()),d.IPv6&&"function"==typeof d.IPv6.noConflict&&(a.IPv6=d.IPv6.noConflict()),d.SecondLevelDomains&&"function"==typeof d.SecondLevelDomains.noConflict&&(a.SecondLevelDomains=d.SecondLevelDomains.noConflict()),a):(d.URI===this&&(d.URI=r),this)},b.build=function(b){return!0===b?this._deferred_build=!0:(void 0===b||this._deferred_build)&&(this._string=a.build(this._parts),this._deferred_build=!1),this},b.clone=function(){return new a(this)},b.valueOf=b.toString=function(){return this.build(!1)._string},b.protocol=i("protocol"),b.username=i("username"),b.password=i("password"),b.hostname=i("hostname"),b.port=i("port"),b.query=s("query","?"),b.fragment=s("fragment","#"),b.search=function(b,c){var a=this.query(b,c);return"string"==typeof a&&a.length?"?"+a:a},b.hash=function(b,c){var a=this.fragment(b,c);return"string"==typeof a&&a.length?"#"+a:a},b.pathname=function(b,d){if(void 0===b||!0===b){var c=this._parts.path||(this._parts.hostname?"/":"");return b?a.decodePath(c):c}return this._parts.path=b?a.recodePath(b):"/",this.build(!d),this},b.path=b.pathname,b.href=function(b,g){var f,c,d;if(void 0===b)return this.toString();if(this._string="",this._parts=a._parts(),c=b instanceof a,d="object"==typeof b&&(b.hostname||b.path||b.pathname),b.nodeName&&(d=a.getDomAttribute(b),b=b[d]||"",d=!1),!c&&d&&void 0!==b.pathname&&(b=b.toString()),"string"==typeof b||b instanceof String)this._parts=a.parse(String(b),this._parts);else if(c||d)for(f in c=c?b._parts:b,c)e.call(this._parts,f)&&(this._parts[f]=c[f]);else throw new TypeError("invalid input");return this.build(!g),this},b.is=function(k){var c=!1,d=!1,e=!1,b=!1,i=!1,h=!1,j=!1,f=!this._parts.urn;switch(this._parts.hostname&&(f=!1,d=a.ip4_expression.test(this._parts.hostname),e=a.ip6_expression.test(this._parts.hostname),c=d||e,i=(b=!c)&&g&&g.has(this._parts.hostname),h=b&&a.idn_expression.test(this._parts.hostname),j=b&&a.punycode_expression.test(this._parts.hostname)),k.toLowerCase()){case"relative":return f;case"absolute":return!f;case"domain":case"name":return b;case"sld":return i;case"ip":return c;case"ip4":case"ipv4":case"inet4":return d;case"ip6":case"ipv6":case"inet6":return e;case"idn":return h;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return j}return null},u=b.protocol,v=b.port,t=b.hostname,b.protocol=function(b,c){if(void 0!==b&&b&&(b=b.replace(/:(\/\/)?$/,""),!b.match(a.protocol_expression)))throw new TypeError('Protocol "'+b+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return u.call(this,b,c)},b.scheme=b.protocol,b.port=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a&&(0===a&&(a=null),a&&(a+="",":"===a.charAt(0)&&(a=a.substring(1)),a.match(/[^0-9]/))))throw new TypeError('Port "'+a+'" contains characters other than [0-9]');return v.call(this,a,b)},b.hostname=function(b,d){if(this._parts.urn)return void 0===b?"":this;if(void 0!==b){var c={};a.parseHost(b,c),b=c.hostname}return t.call(this,b,d)},b.host=function(b,c){return this._parts.urn?void 0===b?"":this:void 0===b?this._parts.hostname?a.buildHost(this._parts):"":(a.parseHost(b,this._parts),this.build(!c),this)},b.authority=function(b,c){return this._parts.urn?void 0===b?"":this:void 0===b?this._parts.hostname?a.buildAuthority(this._parts):"":(a.parseAuthority(b,this._parts),this.build(!c),this)},b.userinfo=function(b,d){if(this._parts.urn)return void 0===b?"":this;if(void 0===b){if(!this._parts.username)return"";var c=a.buildUserinfo(this._parts);return c.substring(0,c.length-1)}return"@"!==b[b.length-1]&&(b+="@"),a.parseUserinfo(b,this._parts),this.build(!d),this},b.resource=function(c,d){var b;return void 0===c?this.path()+this.search()+this.hash():(b=a.parse(c),this._parts.path=b.path,this._parts.query=b.query,this._parts.fragment=b.fragment,this.build(!d),this)},b.subdomain=function(b,d){if(this._parts.urn)return void 0===b?"":this;if(void 0===b){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,c)||""}return c=this._parts.hostname.length-this.domain().length,c=this._parts.hostname.substring(0,c),c=new RegExp("^"+f(c)),b&&"."!==b.charAt(b.length-1)&&(b+="."),b&&a.ensureValidHostname(b),this._parts.hostname=this._parts.hostname.replace(c,b),this.build(!d),this},b.domain=function(b,d){if(this._parts.urn)return void 0===b?"":this;if("boolean"==typeof b&&(d=b,b=void 0),void 0===b){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.match(/\./g);return c&&2>c.length?this._parts.hostname:(c=this._parts.hostname.length-this.tld(d).length-1,c=this._parts.hostname.lastIndexOf(".",c-1)+1,this._parts.hostname.substring(c)||"")}if(!b)throw new TypeError("cannot set domain empty");return a.ensureValidHostname(b),!this._parts.hostname||this.is("IP")?this._parts.hostname=b:(c=new RegExp(f(this.domain())+"$"),this._parts.hostname=this._parts.hostname.replace(c,b)),this.build(!d),this},b.tld=function(a,c){if(this._parts.urn)return void 0===a?"":this;if("boolean"==typeof a&&(c=a,a=void 0),void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var b=this._parts.hostname.lastIndexOf("."),b=this._parts.hostname.substring(b+1);return!0!==c&&g&&g.list[b.toLowerCase()]?g.get(this._parts.hostname)||b:b}if(a)if(a.match(/[^a-zA-Z0-9-]/))if(g&&g.is(a))b=new RegExp(f(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(b,a);else throw new TypeError('TLD "'+a+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");b=new RegExp(f(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(b,a)}else throw new TypeError("cannot set TLD empty");return this.build(!c),this},b.directory=function(b,d){if(this._parts.urn)return void 0===b?"":this;if(void 0===b||!0===b){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var c=this._parts.path.length-this.filename().length-1,c=this._parts.path.substring(0,c)||(this._parts.hostname?"/":"");return b?a.decodePath(c):c}return c=this._parts.path.length-this.filename().length,c=this._parts.path.substring(0,c),c=new RegExp("^"+f(c)),this.is("relative")||(b||(b="/"),"/"!==b.charAt(0)&&(b="/"+b)),b&&"/"!==b.charAt(b.length-1)&&(b+="/"),b=a.recodePath(b),this._parts.path=this._parts.path.replace(c,b),this.build(!d),this},b.filename=function(b,d){var c,e;return this._parts.urn?void 0===b?"":this:void 0===b||!0===b?!this._parts.path||"/"===this._parts.path?"":(c=this._parts.path.lastIndexOf("/"),c=this._parts.path.substring(c+1),b?a.decodePathSegment(c):c):(c=!1,"/"===b.charAt(0)&&(b=b.substring(1)),b.match(/\.?\//)&&(c=!0),e=new RegExp(f(this.filename())+"$"),b=a.recodePath(b),this._parts.path=this._parts.path.replace(e,b),c?this.normalizePath(d):this.build(!d),this)},b.suffix=function(b,e){if(this._parts.urn)return void 0===b?"":this;if(void 0===b||!0===b){if(!this._parts.path||"/"===this._parts.path)return"";var c=this.filename(),d=c.lastIndexOf(".");return-1===d?"":(c=c.substring(d+1),c=/^[a-z0-9%]+$/i.test(c)?c:"",b?a.decodePathSegment(c):c)}if("."===b.charAt(0)&&(b=b.substring(1)),c=this.suffix())d=b?new RegExp(f(c)+"$"):new RegExp(f("."+c)+"$");else{if(!b)return this;this._parts.path+="."+a.recodePath(b)}return d&&(b=a.recodePath(b),this._parts.path=this._parts.path.replace(d,b)),this.build(!e),this},b.segment=function(b,d,e){var f=this._parts.urn?":":"/",a=this.path(),g="/"===a.substring(0,1),a=a.split(f),h;if(void 0!==b&&"number"!=typeof b&&(e=d,d=b,b=void 0),void 0!==b&&"number"!=typeof b)throw Error('Bad segment "'+b+'", must be 0-based integer');if(g&&a.shift(),0>b&&(b=Math.max(a.length+b,0)),void 0===d)return void 0===b?a:a[b];if(null===b||void 0===a[b])if(c(d)){{a=[],b=0;for(h=d.length;b<h;b++)(d[b].length||a.length&&a[a.length-1].length)&&(a.length&&!a[a.length-1].length&&a.pop(),a.push(d[b]))}}else(d||"string"==typeof d)&&(""===a[a.length-1]?a[a.length-1]=d:a.push(d));else d?a[b]=d:a.splice(b,1);return g&&a.unshift(""),this.path(a.join(f),e)},b.segmentCoded=function(b,d,g){var e,f;if("number"!=typeof b&&(g=d,d=b,b=void 0),void 0===d){if(b=this.segment(b,d,g),c(b))for(e=0,f=b.length;e<f;e++)b[e]=a.decode(b[e]);else b=void 0!==b?a.decode(b):void 0;return b}if(c(d))for(e=0,f=d.length;e<f;e++)d[e]=a.decode(d[e]);else d="string"==typeof d||d instanceof String?a.encode(d):d;return this.segment(b,d,g)},w=b.query,b.query=function(b,c){if(!0===b)return a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof b){var d=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace),e=b.call(this,d);return this._parts.query=a.buildQuery(e||d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!c),this}return void 0!==b&&"string"!=typeof b?(this._parts.query=a.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!c),this):w.call(this,b,c)},b.setQuery=function(b,c,g){var d=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace),f;if("string"==typeof b||b instanceof String)d[b]=void 0!==c?c:null;else if("object"==typeof b)for(f in b)e.call(b,f)&&(d[f]=b[f]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=a.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof b&&(g=c),this.build(!g),this},b.addQuery=function(c,b,d){var e=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.addQuery(e,c,void 0===b?null:b),this._parts.query=a.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof c&&(d=b),this.build(!d),this},b.removeQuery=function(b,c,d){var e=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.removeQuery(e,b,c),this._parts.query=a.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof b&&(d=c),this.build(!d),this},b.hasQuery=function(b,c,d){var e=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.hasQuery(e,b,c,d)},b.setSearch=b.setQuery,b.addSearch=b.addQuery,b.removeSearch=b.removeQuery,b.hasSearch=b.hasQuery,b.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},b.normalizeProtocol=function(a){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!a)),this},b.normalizeHostname=function(a){return this._parts.hostname&&(this.is("IDN")&&h?this._parts.hostname=h.toASCII(this._parts.hostname):this.is("IPv6")&&q&&(this._parts.hostname=q.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!a)),this},b.normalizePort=function(b){return"string"==typeof this._parts.protocol&&this._parts.port===a.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!b)),this},b.normalizePath=function(g){if(this._parts.urn||!this._parts.path||"/"===this._parts.path)return this;var f,b=this._parts.path,d="",c,e;for("/"!==b.charAt(0)&&(f=!0,b="/"+b),b=b.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),f&&(d=b.substring(1).match(/^(\.\.\/)+/)||"")&&(d=d[0]);;){if(c=b.indexOf("/.."),-1===c)break;if(0===c){b=b.substring(3);continue}e=b.substring(0,c).lastIndexOf("/"),-1===e&&(e=c),b=b.substring(0,e)+b.substring(c+3)}return f&&this.is("relative")&&(b=d+b.substring(1)),b=a.recodePath(b),this._parts.path=b,this.build(!g),this},b.normalizePathname=b.normalizePath,b.normalizeQuery=function(b){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(a.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!b)),this},b.normalizeFragment=function(a){return this._parts.fragment||(this._parts.fragment=null,this.build(!a)),this},b.normalizeSearch=b.normalizeQuery,b.normalizeHash=b.normalizeFragment,b.iso8859=function(){var b=a.encode,c=a.decode;return a.encode=escape,a.decode=decodeURIComponent,this.normalize(),a.encode=b,a.decode=c,this},b.unicode=function(){var b=a.encode,c=a.decode;return a.encode=n,a.decode=unescape,this.normalize(),a.encode=b,a.decode=c,this},b.readable=function(){var b=this.clone(),c,d,e,g,i,f;if(b.username("").password("").normalize(),c="",b._parts.protocol&&(c+=b._parts.protocol+"://"),b._parts.hostname&&(b.is("punycode")&&h?(c+=h.toUnicode(b._parts.hostname),b._parts.port&&(c+=":"+b._parts.port)):c+=b.host()),b._parts.hostname&&b._parts.path&&"/"!==b._parts.path.charAt(0)&&(c+="/"),c+=b.path(!0),b._parts.query){for(d="",e=0,g=b._parts.query.split("&"),i=g.length;e<i;e++)f=(g[e]||"").split("="),d=d+("&"+a.decodeQuery(f[0],this._parts.escapeQuerySpace).replace(/&/g,"%26")),void 0!==f[1]&&(d+="="+a.decodeQuery(f[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"));c+="?"+d.substring(1)}return c+=a.decodeQuery(b.hash(),!0)},b.absoluteTo=function(c){var b=this.clone(),f=["protocol","username","password","hostname","port"],d,e;if(this._parts.urn)throw Error("URNs do not have any generally defined hierarchical components");if(c instanceof a||(c=new a(c)),b._parts.protocol||(b._parts.protocol=c._parts.protocol),this._parts.hostname)return b;for(d=0;e=f[d];d++)b._parts[e]=c._parts[e];return b._parts.path?".."===b._parts.path.substring(-2)&&(b._parts.path+="/"):(b._parts.path=c._parts.path,b._parts.query||(b._parts.query=c._parts.query)),"/"!==b.path().charAt(0)&&(c=c.directory(),b._parts.path=(c?c+"/":"")+b._parts.path,b.normalizePath()),b.build(),b},b.relativeTo=function(c){var e=this.clone().normalize(),b,d,f,g;if(e._parts.urn)throw Error("URNs do not have any generally defined hierarchical components");if(c=new a(c).normalize(),b=e._parts,d=c._parts,f=e.path(),g=c.path(),"/"!==f.charAt(0))throw Error("URI is already relative");if("/"!==g.charAt(0))throw Error("Cannot calculate a URI relative to another relative URI");if(b.protocol===d.protocol&&(b.protocol=null),b.username===d.username&&b.password===d.password&&null===b.protocol&&null===b.username&&null===b.password&&b.hostname===d.hostname&&b.port===d.port)b.hostname=null,b.port=null;else return e.build();return f===g?(b.path="",e.build()):(c=a.commonPath(e.path(),c.path()),!c)?e.build():(d=d.path.substring(c.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../"),b.path=d+b.path.substring(c.length),e.build())},b.equals=function(g){var h=this.clone(),d,f,i,b;if(g=new a(g),d={},f={},i={},h.normalize(),g.normalize(),h.toString()===g.toString())return!0;if(d=h.query(),f=g.query(),h.query(""),g.query(""),h.toString()!==g.toString()||d.length!==f.length)return!1;d=a.parseQuery(d,this._parts.escapeQuerySpace),f=a.parseQuery(f,this._parts.escapeQuerySpace);for(b in d)if(e.call(d,b)){if(c(d[b])){if(!p(d[b],f[b]))return!1}else if(d[b]!==f[b])return!1;i[b]=!0}for(b in f)if(e.call(f,b)&&!i[b])return!1;return!0},b.duplicateQueryParameters=function(a){return this._parts.duplicateQueryParameters=!!a,this},b.escapeQuerySpace=function(a){return this._parts.escapeQuerySpace=!!a,this},a})